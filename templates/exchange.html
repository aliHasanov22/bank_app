{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    
    <div class="row g-4">
        
        <div class="col-12 col-lg-7">
            <div class="card border-0 shadow-sm h-100" style="border-radius: 20px;">
                <div class="card-body p-5">
                    
                    <h4 class="fw-bold mb-4 text-dark">
                        <i class="fas fa-sync-alt text-primary me-2"></i>Currency Exchange
                    </h4>

                    <form method="POST">
                        
                        <div class="mb-4">
                            <label class="form-label text-muted fw-bold small text-uppercase">You Send (Sell)</label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text bg-white border-end-0 text-muted">
                                    <i class="fas fa-wallet"></i>
                                </span>
                                <input type="number" step="0.01" name="amount" class="form-control border-start-0 ps-0 fs-4 fw-bold text-dark" placeholder="0.00" required>
                                <span class="input-group-text bg-light fw-bold" id="from-currency-label">---</span>
                            </div>
                            <div class="form-text mt-2">
                                <small>Available: <span class="text-dark fw-bold" id="avail-balance">---</span></small>
                            </div>
                            <div class="mt-3">
                                <label class="form-label text-muted fw-bold small text-uppercase">From Card</label>
                                <select name="from_card" class="form-select bg-light fw-bold" id="from-card-select">
                                    {% for card in cards %}
                                    <option value="{{ card.card_number }}"
                                            data-balance="{{ card.balance }}"
                                            data-currency="{{ card.currency }}">
                                        {{ card.card_type }} ****{{ card.card_number[-4:] }} ({{ card.currency }})
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="text-center my-2 position-relative">
                            <hr class="text-muted opacity-25">
                            <div class="position-absolute top-50 start-50 translate-middle bg-white px-2">
                                <i class="fas fa-arrow-down text-primary p-2 rounded-circle border"></i>
                            </div>
                        </div>

                        <div class="mb-5 mt-4">
                            <label class="form-label text-muted fw-bold small text-uppercase">You Get (Buy)</label>
                            <div class="input-group input-group-lg">
                                <select name="to_card" class="form-select bg-light fw-bold" id="to-card-select">
                                    {% for card in cards %}
                                    <option value="{{ card.card_number }}"
                                            data-currency="{{ card.currency }}">
                                        {{ card.card_type }} ****{{ card.card_number[-4:] }} ({{ card.currency }})
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-text mt-2">
                                <small>Receive in: <span class="text-dark fw-bold" id="to-currency-label">---</span></small>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 py-3 rounded-pill fw-bold fs-5 shadow-sm hover-lift">
                            Convert Money
                        </button>

                    </form>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-5">
            <div class="d-flex flex-column gap-4">
                
                <div class="card border-0 shadow-sm" style="border-radius: 20px;">
                    <div class="card-body p-4">
                        <h6 class="text-uppercase text-muted fw-bold mb-3 small">Your Cards</h6>
                        
                        {% for card in cards %}
                        <div class="d-flex align-items-center justify-content-between p-3 rounded-3 mb-2 bg-light">
                            <div class="d-flex align-items-center gap-3">
                                <div class="rounded-circle bg-white shadow-sm d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <i class="fas fa-credit-card text-primary"></i>
                                </div>
                                <span class="fw-bold text-dark">{{ card.card_type }} ****{{ card.card_number[-4:] }}</span>
                            </div>
                            <span class="fw-bold fs-5">{{ "%.2f"|format(card.balance) }} {{ card.currency }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="card border-0 shadow-sm bg-dark text-white" style="border-radius: 20px; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);">
                    <div class="card-body p-4">
                        <h6 class="text-uppercase text-white-50 fw-bold mb-3 small">Indicative Rates</h6>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3 border-bottom border-secondary pb-2">
                            <span>USD <i class="fas fa-arrow-right mx-2 text-muted"></i> AZN</span>
                            <span class="fw-bold text-success">1.7000</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3 border-bottom border-secondary pb-2">
                            <span>EUR <i class="fas fa-arrow-right mx-2 text-muted"></i> AZN</span>
                            <span class="fw-bold text-warning">1.8500</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-0">
                            <span>EUR <i class="fas fa-arrow-right mx-2 text-muted"></i> USD</span>
                            <span class="fw-bold text-info">1.0900</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    const fromSelect = document.getElementById('from-card-select');
    const toSelect = document.getElementById('to-card-select');
    const display = document.getElementById('avail-balance');
    const fromCurrencyLabel = document.getElementById('from-currency-label');
    const toCurrencyLabel = document.getElementById('to-currency-label');

    function updateBalance() {
        if (!fromSelect.options.length || !toSelect.options.length) {
            display.innerText = '---';
            fromCurrencyLabel.innerText = '---';
            toCurrencyLabel.innerText = '---';
            return;
        }

        const fromOption = fromSelect.options[fromSelect.selectedIndex];
        const toOption = toSelect.options[toSelect.selectedIndex];
        const balance = parseFloat(fromOption.getAttribute('data-balance')) || 0;
        const fromCurrency = fromOption.getAttribute('data-currency') || '---';
        const toCurrency = toOption.getAttribute('data-currency') || '---';

        display.innerText = balance.toFixed(2) + ' ' + fromCurrency;
        fromCurrencyLabel.innerText = fromCurrency;
        toCurrencyLabel.innerText = toCurrency;
    }
    
    fromSelect.addEventListener('change', updateBalance);
    toSelect.addEventListener('change', updateBalance);
    updateBalance();
</script>
{% endblock %}
